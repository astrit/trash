// app/page.tsx
"use client";

import { useState, useEffect } from "react";
import "./page.css";
import Image from "next/image";
import Link from "next/link";

interface Schedule {
  day: string;
  time: string;
  location: string;
}

export default function Home() {
  const [loading, setLoading] = useState(true);
  const [scheduleData, setScheduleData] = useState<Schedule[]>([]);
  const [searchTerm, setSearchTerm] = useState("");

  useEffect(() => {
    const fetchData = async () => {
      try {
        setLoading(true);
        const response = await fetch("/api/scrape");
        const data = await response.json();

        const parser = new DOMParser();
        const doc = parser.parseFromString(data.tableContent, "text/html");
        const rows = doc.querySelectorAll("tbody tr");

        const schedules: Schedule[] = Array.from(rows).map((row) => {
          const cells = Array.from(row.getElementsByTagName("td"));
          return {
            day: cells[0]?.textContent?.trim() || "",
            time: cells[1]?.textContent?.trim() || "",
            location: cells[2]?.textContent?.trim() || "",
          };
        });

        setScheduleData(schedules);
      } catch (error) {
        console.error("Error fetching data:", error);
      } finally {
        setLoading(false);
      }
    };

    fetchData();
  }, []);

  const filteredSchedules = scheduleData.filter((schedule) =>
    Object.values(schedule).some((value) =>
      value.toLowerCase().includes(searchTerm.toLowerCase())
    )
  );

  if (loading) return null;

  return (
    <div className="page">
      <header>
        <svg viewBox="0 0 24 24">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
        <input
          type="text"
          placeholder="Search..."
          value={searchTerm}
          onChange={(e) => setSearchTerm(e.target.value)}
          className="input"
        />

        <a href="https://github.com/astrit" className="author">
          <Image
            src="https://github.com/astrit.png"
            width={24}
            height={24}
            alt="@astrit"
            unoptimized
          />
          <div className="span">Astrit</div>
        </a>
      </header>

      <div className="list">
        {filteredSchedules.map((schedule, index) => (
          <div key={index} className="item">
            <div className="part day">
              <svg viewBox="0 0 24 24">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
              </svg>
              <span>{schedule.day}</span>
            </div>
            <div className="part time">
              <svg viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
              </svg>
              <span>{schedule.time}</span>
            </div>
            <div className="part place">
              <svg viewBox="0 0 24 24">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <circle cx="12" cy="10" r="3"></circle>
              </svg>
              <span>{schedule.location}</span>
            </div>
          </div>
        ))}
        <Link
          href="https://www.solna.se/bygga-bo--miljo/avfall-och-atervinning/mobil-atervinningscentral-och-mobil-miljostation"
          target="_blank"
          className="source"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 200 70.841"
            width="200"
            height="71"
          >
            <path
              d="M77.455 32.417a3.351 3.351 0 0 0-1.25-2.512 4.544 4.544 0 0 0-2.737-.777 6.542 6.542 0 0 0-1.329.135 3.528 3.528 0 0 0-1.16.45 2.375 2.375 0 0 0-.812.845 2.622 2.622 0 0 0-.3 1.318 1.675 1.675 0 0 0 .44 1.205 3.244 3.244 0 0 0 1.171.755 9.806 9.806 0 0 0 1.656.484q.924.192 1.892.417t1.892.529a6.079 6.079 0 0 1 1.645.823 3.912 3.912 0 0 1 1.16 1.318 4.552 4.552 0 0 1-.135 4.167 4.738 4.738 0 0 1-1.475 1.487 6.617 6.617 0 0 1-2.017.845 9.555 9.555 0 0 1-4.775-.068A6.177 6.177 0 0 1 69.2 42.8a4.952 4.952 0 0 1-1.442-1.768 5.658 5.658 0 0 1-.529-2.535h2.027a3.619 3.619 0 0 0 .4 1.746 3.571 3.571 0 0 0 1.036 1.205 4.365 4.365 0 0 0 1.486.7 6.851 6.851 0 0 0 1.769.225 8 8 0 0 0 1.453-.135 4.279 4.279 0 0 0 1.318-.462 2.475 2.475 0 0 0 1.307-2.332 2.017 2.017 0 0 0-.44-1.351 3.262 3.262 0 0 0-1.16-.845 8.758 8.758 0 0 0-1.644-.54q-.924-.215-1.893-.417t-1.892-.485a6.572 6.572 0 0 1-1.656-.754 3.7 3.7 0 0 1-1.171-1.2 3.451 3.451 0 0 1-.44-1.824 4.26 4.26 0 0 1 .5-2.107 4.322 4.322 0 0 1 1.318-1.464 5.918 5.918 0 0 1 1.869-.856 8.248 8.248 0 0 1 2.152-.282 8.606 8.606 0 0 1 2.3.293 5.112 5.112 0 0 1 1.847.924 4.621 4.621 0 0 1 1.261 1.588 5.541 5.541 0 0 1 .519 2.287h-2.04m3.857 3.34a10.359 10.359 0 0 1 .484-3.165 7.972 7.972 0 0 1 1.453-2.692 7.081 7.081 0 0 1 2.411-1.87 8.408 8.408 0 0 1 6.713 0 7.1 7.1 0 0 1 2.411 1.87 7.987 7.987 0 0 1 1.452 2.692 10.57 10.57 0 0 1 0 6.33 7.987 7.987 0 0 1-1.452 2.692 7.1 7.1 0 0 1-2.411 1.87 8.419 8.419 0 0 1-6.713 0 7.081 7.081 0 0 1-2.411-1.87 7.972 7.972 0 0 1-1.449-2.692 10.364 10.364 0 0 1-.484-3.165m2.14 0a9.237 9.237 0 0 0 .316 2.4 6.508 6.508 0 0 0 .991 2.129 5.055 5.055 0 0 0 1.734 1.52 5.825 5.825 0 0 0 5.047 0 5.065 5.065 0 0 0 1.734-1.52 6.508 6.508 0 0 0 .991-2.129 9.264 9.264 0 0 0 0-4.8 6.489 6.489 0 0 0-.991-2.129A5.067 5.067 0 0 0 91.54 29.7a5.834 5.834 0 0 0-5.047 0 5.058 5.058 0 0 0-1.734 1.521 6.489 6.489 0 0 0-.991 2.129 9.237 9.237 0 0 0-.316 2.401zm15.441-8.043h2.14v14.283h8.515v1.802H98.897V27.708m12.277 0h2.276l8.47 13.044h.045V27.708h2.028v16.085h-2.343l-8.403-12.908h-.045v12.908h-2.028V27.708m20.336 0h2.365l6.286 16.085h-2.366l-1.757-4.843h-6.8l-1.8 4.843h-2.207l6.285-16.085m-1.6 9.439h5.452l-2.681-7.5h-.045zm27.384-4.73a3.354 3.354 0 0 0-1.25-2.512 4.544 4.544 0 0 0-2.737-.777 6.542 6.542 0 0 0-1.329.135 3.524 3.524 0 0 0-1.161.45 2.381 2.381 0 0 0-.811.845 2.622 2.622 0 0 0-.3 1.318 1.671 1.671 0 0 0 .44 1.205 3.244 3.244 0 0 0 1.171.755 9.806 9.806 0 0 0 1.656.484q.924.192 1.892.417t1.892.529a6.079 6.079 0 0 1 1.645.823 3.922 3.922 0 0 1 1.16 1.318 4.56 4.56 0 0 1-.135 4.167 4.73 4.73 0 0 1-1.476 1.487 6.611 6.611 0 0 1-2.016.845 9.559 9.559 0 0 1-4.776-.068 6.2 6.2 0 0 1-2.118-1.036 4.96 4.96 0 0 1-1.441-1.768 5.658 5.658 0 0 1-.529-2.535h2.023a3.631 3.631 0 0 0 .394 1.746 3.583 3.583 0 0 0 1.036 1.205 4.379 4.379 0 0 0 1.487.7 6.845 6.845 0 0 0 1.769.225 8 8 0 0 0 1.453-.135 4.263 4.263 0 0 0 1.317-.462 2.47 2.47 0 0 0 1.307-2.332 2.016 2.016 0 0 0-.439-1.351 3.262 3.262 0 0 0-1.16-.845 8.744 8.744 0 0 0-1.645-.54q-.924-.215-1.892-.417t-1.892-.485a6.572 6.572 0 0 1-1.656-.754 3.713 3.713 0 0 1-1.172-1.2 3.451 3.451 0 0 1-.439-1.824 4.26 4.26 0 0 1 .5-2.107 4.322 4.322 0 0 1 1.318-1.464 5.918 5.918 0 0 1 1.869-.856 8.248 8.248 0 0 1 2.152-.282 8.612 8.612 0 0 1 2.3.293 5.112 5.112 0 0 1 1.847.924 4.633 4.633 0 0 1 1.261 1.588 5.557 5.557 0 0 1 .519 2.287H157.3m8.253-2.902h-5.361v-1.803h12.863v1.803h-5.362v14.282h-2.14V29.511m11.309-1.803h2.365l6.286 16.085h-2.366l-1.757-4.843h-6.8l-1.8 4.843h-2.208l6.285-16.085m-1.6 9.439h5.451l-2.68-7.5h-.045zm11.487-9.439h5.519A8.018 8.018 0 0 1 198 29.6q2 1.892 2 5.767a12.993 12.993 0 0 1-.451 3.593 6.7 6.7 0 0 1-1.4 2.636 6.057 6.057 0 0 1-2.411 1.633 9.666 9.666 0 0 1-3.469.563h-5.519V27.708m2.14 14.283h3.559q.361 0 .9-.056a5.052 5.052 0 0 0 1.149-.271 5.224 5.224 0 0 0 1.205-.619 4.082 4.082 0 0 0 1.071-1.1 6.189 6.189 0 0 0 .777-1.746 9.209 9.209 0 0 0 .3-2.534 10.762 10.762 0 0 0-.282-2.58 4.854 4.854 0 0 0-.923-1.926 4.2 4.2 0 0 0-1.646-1.22 6.446 6.446 0 0 0-2.5-.428h-3.6zM43.648 8.589L41.354 5.9a.357.357 0 0 1-.085-.231v-.1h-2.562v.1a.35.35 0 0 1-.086.231L36.33 8.589h7.318m-10.525 0L30.831 5.9a.352.352 0 0 1-.085-.231v-.1h-2.534v.1a.351.351 0 0 1-.087.231l-2.291 2.689h7.289m-10.497 0L20.334 5.9a.351.351 0 0 1-.084-.231v-.1h-2.536v.1a.345.345 0 0 1-.086.231l-2.291 2.689h7.289m1.96.715h21.546v2.667H24.586zM12.13 8.589L9.838 5.9a.357.357 0 0 1-.085-.231v-.1H7.19v.1a.348.348 0 0 1-.09.231L4.811 8.589h7.319m-9.803.715h21.546v2.667H2.327zM46.785 0v1.964a.357.357 0 0 1-.355.358h-2.246a.359.359 0 0 1-.355-.358V0h-1.843v5.533l2.547 3h1.43l2.5-2.994V0h-1.678M3.925 8.529l2.55-3V0H4.739v1.964a.36.36 0 0 1-.357.358H2.138a.358.358 0 0 1-.253-.106.354.354 0 0 1-.1-.252V0H0v5.535l2.494 2.994h1.431m10.525 0l2.549-3V0h-1.846v1.964a.359.359 0 0 1-.356.358h-2.244a.36.36 0 0 1-.358-.358V0h-1.728v5.533l2.55 3h1.433m10.496-.004l2.549-3V0H25.65v1.964a.357.357 0 0 1-.357.358H23.05a.36.36 0 0 1-.358-.358V0h-1.729v5.533l2.55 3h1.433m10.496-.004l2.549-3V0h-1.845v1.964a.358.358 0 0 1-.357.358h-2.244a.352.352 0 0 1-.251-.106.356.356 0 0 1-.1-.252V0H31.46v5.533l2.551 3h1.431M15.293 41.955a11.888 11.888 0 0 0-3.838 2.34c-1.592 1.408-2.879.582-4.21 1.485a2.689 2.689 0 0 0-1.107 2.481 4.548 4.548 0 0 1 2.989-1c1.5.034 2.649.385 4.416-.786a8.04 8.04 0 0 1 3.157-1.209l-7.141 9.719 9.706-7.091a11.863 11.863 0 0 0-1.065 4.368c-.129 2.122-1.623 2.448-1.925 4.027a2.688 2.688 0 0 0 .972 2.537 4.547 4.547 0 0 1 1.408-2.82c1.086-1.036 2.144-1.6 2.565-3.678a8.01 8.01 0 0 1 1.38-3.091l1.821 11.924 1.849-11.875a11.867 11.867 0 0 0 2.34 3.837c1.408 1.6.581 2.88 1.485 4.211a2.688 2.688 0 0 0 2.48 1.1 4.526 4.526 0 0 1-1-2.986c.035-1.5.385-2.651-.787-4.419a8.033 8.033 0 0 1-1.21-3.159l9.72 7.145-7.093-9.707a11.834 11.834 0 0 0 4.369 1.06C38.7 46.5 39.024 48 40.6 48.3a2.7 2.7 0 0 0 2.537-.975 4.545 4.545 0 0 1-2.82-1.408c-1.038-1.086-1.6-2.145-3.679-2.566a8 8 0 0 1-3.091-1.38l11.926-1.82L33.6 38.306a11.832 11.832 0 0 0 3.839-2.338c1.592-1.408 2.879-.582 4.21-1.485A2.684 2.684 0 0 0 42.752 32a4.518 4.518 0 0 1-2.986 1c-1.5-.033-2.65-.384-4.417.788a7.985 7.985 0 0 1-3.159 1.21l7.145-9.719-9.708 7.091a11.847 11.847 0 0 0 1.06-4.37c.13-2.123 1.625-2.448 1.931-4.029a2.7 2.7 0 0 0-.976-2.536 4.531 4.531 0 0 1-1.407 2.819c-1.087 1.037-2.146 1.6-2.567 3.678a8.007 8.007 0 0 1-1.379 3.09L24.467 19.1l-1.846 11.88a11.857 11.857 0 0 0-2.339-3.84c-1.409-1.593-.581-2.879-1.484-4.21a2.692 2.692 0 0 0-2.482-1.106 4.532 4.532 0 0 1 1 2.989c-.034 1.5-.384 2.65.787 4.416a7.973 7.973 0 0 1 1.21 3.16l-9.722-7.144 7.093 9.7a11.916 11.916 0 0 0-4.368-1.061c-2.123-.129-2.448-1.623-4.027-1.925a2.693 2.693 0 0 0-2.537.972 4.536 4.536 0 0 1 2.818 1.413c1.038 1.086 1.6 2.146 3.678 2.566a8 8 0 0 1 3.092 1.378L3.415 40.109l11.878 1.846m5.716-3.061a.942.942 0 0 1-.929-.811.369.369 0 0 0 .607-.286.366.366 0 0 0-.2-.326 2.26 2.26 0 0 0-.775.358.154.154 0 0 1-.21-.037.154.154 0 0 1 .037-.211 2.543 2.543 0 0 1 1.47-.479 2.787 2.787 0 0 1 1.477.439.152.152 0 0 1 .037.211.148.148 0 0 1-.209.036 2.438 2.438 0 0 0-.365-.189c-.025-.012-.056-.021-.083-.031a.924.924 0 0 1 .089.383.943.943 0 0 1-.946.943zm3.314 7.718a2.159 2.159 0 0 1-1.386-.538c0-.1.614.128 1.379.128s1.344-.245 1.344-.128a1.974 1.974 0 0 1-1.337.538zm2.417-1.8a4.648 4.648 0 0 1-2.488.769 4.237 4.237 0 0 1-2.386-.762c-.218-.121-.023-.228.162-.228.5 0 1.232-.283 2.224-.283.924 0 1.747.269 2.247.269.232 0 .458.095.241.235zm2.307-7a.153.153 0 0 1-.124.063.142.142 0 0 1-.084-.026 2.5 2.5 0 0 0-.4-.226 1.567 1.567 0 0 1 .038.269.94.94 0 0 1-1.835.288.364.364 0 0 0 .2.062.373.373 0 0 0 .374-.371.368.368 0 0 0-.3-.359 2.685 2.685 0 0 0-.315.107 1.975 1.975 0 0 0-.363.187.156.156 0 0 1-.213-.036.153.153 0 0 1 .038-.212 2.788 2.788 0 0 1 1.476-.438 2.537 2.537 0 0 1 1.471.479.151.151 0 0 1 .037.216zm-4.341-1.422a4.288 4.288 0 0 1 1.614-.661 5.565 5.565 0 0 1 2.952.124c.63.157.739.327.708.388s-.1.109-.759-.071a5.675 5.675 0 0 0-2.814-.048 2.961 2.961 0 0 0-1.64.878 2.26 2.26 0 0 0-.306 1.435c0 .4.031.818.065 1.151 0 .045.01.086.014.129a15.053 15.053 0 0 0 .359 1.661c.144.587.914.3.819 1.052-.046.353-.314.3-.7.445s-.187.371-.758.371-.372-.226-.76-.371-.637-.093-.7-.445c-.017-.084.094.014.285.1.125.055.316.04.5.106a1.64 1.64 0 0 0 .576.158.948.948 0 0 0 .358-.094c.287-.16.22-.5-.047-1.667a7.269 7.269 0 0 1-.165-.888 12.023 12.023 0 0 1-.232-2.132 1.674 1.674 0 0 1 .631-1.621zm-5.5-.537a5.386 5.386 0 0 1 3.052-.124 5.812 5.812 0 0 1 1.459.625 1.207 1.207 0 0 0-.2.644 3.18 3.18 0 0 0-1.353-.876 6.3 6.3 0 0 0-2.911.048c-.659.174-.725.134-.759.071s.092-.206.714-.388z"
              fill="#fff"
            />
            <path
              d="M47.728 15.3h-1.6v-2.613H34.705V15.3h-.713v-2.613h-20.33V15.3h-.716v-2.613H2.327V15.3H.742a.7.7 0 0 0-.7.7c0 1.732-.029 42.433 0 43.661a8.624 8.624 0 0 0 8.573 8.219h10.263a4.99 4.99 0 0 1 4.736 2.54.7.7 0 0 0 .646.421h.011a.706.706 0 0 0 .644-.445c.041-.1 1.049-2.516 4.682-2.516h10.229a8.564 8.564 0 0 0 6.257-2.664 8.2 8.2 0 0 0 2.349-5.554V16a.7.7 0 0 0-.7-.7m-.7 44.365a6.882 6.882 0 0 1-1.959 4.583 7.17 7.17 0 0 1-5.239 2.228H29.6a6.443 6.443 0 0 0-5.358 2.351 6.638 6.638 0 0 0-5.357-2.351H8.615c-3.384 0-7.169-2.912-7.169-6.827-.027-1.14 0-37.4 0-42.941h45.578v42.953z"
              fill="#fff"
            />
          </svg>
        </Link>
      </div>
    </div>
  );
}
